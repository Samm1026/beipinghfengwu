<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒ—å¹³é£ç‰©è®° | æ²‰æµ¸å¼æ–‡åŒ–æ¼«æ¸¸æŒ‡å—</title>
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+SC:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        /* --- æ–°å¢ï¼šæ²‰æµ¸å¼ç™½å™ªéŸ³æŒ‰é’® --- */
.audio-wrapper {
    margin-top: 15px;
    display: flex;
    justify-content: center;
    align-items: center;
}

.ambient-btn {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 20px;
    background: rgba(255, 255, 255, 0.6);
    border: 1px solid var(--c-gray);
    border-radius: 50px;
    cursor: pointer;
    font-family: var(--f-body);
    font-size: 0.9rem;
    color: var(--c-ink);
    transition: all 0.3s ease;
    backdrop-filter: blur(5px);
}

.ambient-btn:hover {
    background: #fff;
    border-color: var(--c-red);
    color: var(--c-red);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.05);
}

/* æ’­æ”¾çŠ¶æ€ */
.ambient-btn.playing {
    background: var(--c-ink);
    border-color: var(--c-ink);
    color: var(--c-paper);
}

.ambient-btn.playing:hover {
    background: var(--c-red);
    border-color: var(--c-red);
}

/* ç®€å•çš„å£°æ³¢åŠ¨ç”»å›¾æ ‡ */
.sound-wave {
    display: flex;
    align-items: center;
    gap: 3px;
    height: 12px;
}

.bar {
    width: 2px;
    height: 100%;
    background-color: currentColor;
    animation: none;
}

.ambient-btn.playing .bar {
    animation: wave 1s infinite ease-in-out;
}

.ambient-btn.playing .bar:nth-child(1) { animation-delay: 0.0s; }
.ambient-btn.playing .bar:nth-child(2) { animation-delay: 0.2s; }
.ambient-btn.playing .bar:nth-child(3) { animation-delay: 0.4s; }
.ambient-btn.playing .bar:nth-child(4) { animation-delay: 0.1s; }

@keyframes wave {
    0%, 100% { height: 20%; }
    50% { height: 100%; }
}
        :root {
            --c-red: #8E354A;       /* å®«å¢™çº¢ */
            --c-ink: #2C2C2C;       /* å¾½å¢¨ */
            --c-gray: #5e616d;      /* ç“¦ç° */
            --c-paper: #F3F1E8;     /* å®£çº¸ç™½ */
            --c-gold: #B59868;      /* éé‡‘ */
            
            --f-title: 'Ma Shan Zheng', cursive;
            --f-body: 'Noto Serif SC', serif;
            
            --nav-height: 80px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            background-color: var(--c-paper);
            color: var(--c-ink);
            font-family: var(--f-body);
            overflow-x: hidden;
            /* çº¸å¼ çº¹ç† */
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E");
        }

        /* --- ã€æ ¸å¿ƒä¿®æ”¹ã€‘å•ç‹¬è®¾ç«‹çš„å›¾ç‰‡ç±» --- */
        .project-img {
            width: 100%;
            height: 500px;          /* ç»Ÿä¸€é«˜åº¦ï¼Œä¿æŒæ•´é½ */
            object-fit: cover;      /* æ™ºèƒ½è£å‰ªï¼Œé˜²æ­¢å˜å½¢ */
            border-radius: 4px;     /* å¾®åœ†è§’ */
            box-shadow: 20px 20px 0px rgba(0,0,0,0.05); /* æ–°ä¸­å¼é˜´å½± */
            transition: transform 0.8s ease, filter 0.5s ease;
            filter: sepia(0.1);     /* è½»å¾®å¤å¤æ»¤é•œ */
        }

        /* é¼ æ ‡æ‚¬åœæ—¶çš„å›¾ç‰‡åŠ¨æ•ˆ */
        .article-block:hover .project-img {
            transform: scale(1.02);
            filter: sepia(0);
        }

        /* --- 0. å¼€åœºåŠ¨ç”» --- */
        #intro-overlay {
            position: fixed; inset: 0; z-index: 9999;
            /* ä½¿ç”¨beijingå›¾ç‰‡ä½œä¸ºåº•å›¾ */
            background: url('image/beijing.jpg') center/cover no-repeat;
            color: var(--c-paper);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 1s ease, visibility 1s;
        }
        #intro-overlay::after {
            content: ''; position: absolute; inset: 0;
            background: rgba(0, 0, 0, 0.5); /* æ·»åŠ åŠé€æ˜é»‘è‰²é®ç½©ï¼Œå¢å¼ºæ–‡å­—å¯è¯»æ€§ */
            pointer-events: none; /* å…è®¸ç‚¹å‡»äº‹ä»¶ç©¿é€åˆ°ä¸‹é¢çš„å…ƒç´  */
        }
        .intro-text { font-family: var(--f-title); font-size: 3.5rem; writing-mode: vertical-rl; letter-spacing: 0.5rem; margin-bottom: 40px; position: relative; z-index: 1; }
        .btn-enter { padding: 12px 40px; border: 1px solid var(--c-paper); background: transparent; color: var(--c-paper); cursor: pointer; font-family: var(--f-body); letter-spacing: 2px; transition: 0.4s; font-size: 1.1rem; position: relative; z-index: 1; }
        .btn-enter:hover { background: var(--c-paper); color: var(--c-ink); box-shadow: 0 0 20px rgba(255,255,255,0.3); }

        /* --- 1. å¯¼èˆªæ  --- */
        nav {
            position: fixed; top: 0; width: 100%; height: var(--nav-height);
            background: rgba(243, 241, 232, 0.95); backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0,0,0,0.05); z-index: 1000;
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 40px; transition: all 0.3s;
        }
        .logo { font-family: var(--f-title); font-size: 2rem; color: var(--c-red); text-decoration: none; }
        .menu { display: flex; gap: 40px; height: 100%; align-items: center; }
        .menu-item { position: relative; height: 100%; display: flex; align-items: center; cursor: pointer; font-size: 1rem; color: var(--c-ink); text-decoration: none; transition: 0.3s; }
        .menu-item:hover { color: var(--c-red); }
        
        /* äºŒçº§èœå• */
        .dropdown {
            position: absolute; top: var(--nav-height); left: 50%; transform: translateX(-50%);
            background: #fff; box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 20px 0; min-width: 180px; opacity: 0; visibility: hidden;
            transition: all 0.3s ease; border-top: 3px solid var(--c-red);
        }
        .menu-item:hover .dropdown { opacity: 1; visibility: visible; top: var(--nav-height); }
        .dropdown a { display: block; padding: 12px 30px; color: #666; text-decoration: none; font-size: 0.95rem; transition: 0.2s; white-space: nowrap; }
        .dropdown a:hover { background: var(--c-paper); color: var(--c-red); padding-left: 35px; }

        /* --- 2. Hero å°é¢ (èƒŒæ™¯å›¾) --- */
        header {
            height: 100vh; position: relative; display: flex; align-items: center; justify-content: center;
            /* ä¿®æ”¹ï¼šä½¿ç”¨æœ¬åœ°å›¾ç‰‡ shouye.png */
            background: url('image/shouye.png') center/cover no-repeat;
        }
        header::after { content: ''; position: absolute; inset: 0; background: linear-gradient(to bottom, rgba(0,0,0,0.2), rgba(243, 241, 232, 1)); }
        .hero-content { position: relative; z-index: 10; text-align: center; }
        .hero-title { font-size: 5rem; writing-mode: vertical-lr; color: #fff; text-shadow: 0 4px 20px rgba(0,0,0,0.5); letter-spacing: 1rem; border-left: 4px solid var(--c-red); padding-left: 30px; margin-left: -30px; }

        /* --- 3. äº¤äº’åœ°å›¾ (èƒŒæ™¯å›¾) --- */
        #map-section { padding: 100px 0; background: #e8e6dc; position: relative; overflow: hidden; }
        .map-container {
            width: 100%; height: 80vh; max-width: 1200px; margin: 0 auto;
            position: relative;
            /* ä¿®æ”¹ï¼šä½¿ç”¨æœ¬åœ°å›¾ç‰‡ ditu.png */
            background: url('image/ditu.png') center/cover no-repeat;
            border-radius: 4px; box-shadow: 0 20px 50px rgba(0,0,0,0.1);
        }
        .map-title { position: absolute; top: 40px; left: 40px; font-family: var(--f-title); font-size: 3rem; color: #fff; text-shadow: 0 2px 10px rgba(0,0,0,0.5); z-index: 20; }
        
        /* åœ°å›¾æ ‡è®°ç‚¹ */
        .pin {
            position: absolute; width: 24px; height: 24px; background: var(--c-red);
            border: 3px solid #fff; border-radius: 50%; cursor: pointer; z-index: 10;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3); transition: transform 0.3s;
        }
        .pin:hover { transform: scale(1.3); }
        .pin::after { content: ''; position: absolute; inset: -10px; border: 2px solid var(--c-red); border-radius: 50%; animation: pulse 2s infinite; opacity: 0; }
        
        .map-card {
            position: absolute; bottom: 40px; left: 40px; width: 300px; background: rgba(255,255,255,0.95);
            padding: 25px; border-left: 5px solid var(--c-red); opacity: 0; transform: translateY(20px);
            transition: all 0.4s ease; pointer-events: none; backdrop-filter: blur(5px);
        }
        .map-card.active { opacity: 1; transform: translateY(0); pointer-events: auto; }

        /* --- 4. è·¯çº¿å¸ƒå±€ --- */
        .route-container { max-width: 1000px; margin: 150px auto; padding: 0 24px; }
        .route-header { text-align: center; margin-bottom: 80px; position: relative; }
        .route-header h2 { font-size: 3.5rem; color: var(--c-red); margin-bottom: 10px; }
        .route-header span { font-size: 1rem; letter-spacing: 4px; color: var(--c-gray); text-transform: uppercase; }
        
        .article-block { display: grid; grid-template-columns: 1fr 1fr; gap: 60px; margin-bottom: 100px; align-items: center; }
        .article-block.reverse { direction: rtl; }
        .article-block.reverse .text-wrap { direction: ltr; }
        
        .text-wrap h3 { font-size: 1.8rem; margin-bottom: 20px; color: var(--c-ink); border-left: 4px solid var(--c-gold); padding-left: 15px; }
        .text-wrap p { line-height: 1.8; margin-bottom: 20px; text-align: justify; font-size: 1.05rem; }
        .text-wrap .drop-cap { float: left; font-size: 3.5rem; line-height: 0.8; padding-right: 10px; color: var(--c-red); font-family: var(--f-title); }
        
        .img-wrap { overflow: hidden; border-radius: 4px; } /* åŒ…è£¹å±‚ */

        /* --- ä»»åŠ¡å¡ --- */
        .task-box {
            background: #222; color: #f3f1e8; padding: 40px; margin: 60px 0;
            text-align: center; border: 1px solid var(--c-gold); position: relative;
            background-image: url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='2' cy='2' r='1' fill='%23B59868' fill-opacity='0.2'/%3E%3C/svg%3E");
        }
        .task-title { color: var(--c-gold); font-family: var(--f-title); font-size: 1.5rem; margin-bottom: 20px; }
        .task-content { font-size: 1.2rem; min-height: 60px; display: flex; align-items: center; justify-content: center; font-style: italic; transition: opacity 0.3s; }
        .btn-task { margin-top: 20px; padding: 10px 30px; background: var(--c-red); border: none; color: white; cursor: pointer; font-family: var(--f-body); font-size: 1rem; }
        .btn-task:hover { background: #fff; color: var(--c-red); }

        /* --- æ–°å¢ï¼šå…³äºæˆ‘ä»¬ / å“ç‰Œç†å¿µæ¿å— --- */
#about {
    padding: 120px 0;
    background: rgba(255, 255, 255, 0.4); /* è½»å¾®é€ç™½ï¼ŒåŒºåˆ«äºèƒŒæ™¯ */
    position: relative;
    border-top: 1px solid rgba(0,0,0,0.05);
    border-bottom: 1px solid rgba(0,0,0,0.05);
}

.about-container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 0 40px;
}

.about-header {
    text-align: center;
    margin-bottom: 60px;
}

.about-header h2 {
    font-family: var(--f-title);
    font-size: 3rem;
    color: var(--c-ink);
    margin-bottom: 15px;
}

.about-header .sub-title {
    color: var(--c-red);
    letter-spacing: 4px;
    font-size: 0.9rem;
    text-transform: uppercase;
}

.concept-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 60px;
}

.concept-card {
    padding: 40px;
    background: #fff;
    border: 1px solid rgba(0,0,0,0.05);
    box-shadow: 10px 10px 30px rgba(0,0,0,0.03);
    border-radius: 4px;
    transition: transform 0.3s ease;
    position: relative;
    overflow: hidden;
}

.concept-card:hover {
    transform: translateY(-5px);
    box-shadow: 15px 15px 40px rgba(0,0,0,0.06);
}

/* è£…é¥°æ€§è¾¹æ¡†ï¼Œå¢åŠ ä¸­å¼éŸµå‘³ */
.concept-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; width: 100%; height: 4px;
    background: var(--c-gold);
    opacity: 0.5;
}

.concept-title {
    font-size: 1.4rem;
    color: var(--c-ink);
    margin-bottom: 25px;
    font-weight: bold;
    display: flex;
    align-items: center;
    gap: 10px;
}

.concept-title span {
    color: var(--c-red);
    font-family: var(--f-title);
    font-size: 1.8rem;
}

.concept-text {
    line-height: 1.8;
    color: #555;
    font-size: 1rem;
    text-align: justify;
}

.highlight-box {
    margin-top: 20px;
    padding: 15px;
    background: var(--c-paper);
    border-left: 3px solid var(--c-red);
    font-size: 0.9rem;
    color: var(--c-gray);
    font-style: italic;
}

@media (max-width: 768px) {
    .concept-grid { grid-template-columns: 1fr; }
    .about-header h2 { font-size: 2.5rem; }
}

        /* Footer */
        footer { background: var(--c-ink); color: #888; padding: 80px 0; text-align: center; }
        .share-btn { padding: 15px 50px; background: transparent; border: 1px solid #666; color: #fff; font-size: 1rem; cursor: pointer; transition: 0.3s; }
        .share-btn:hover { background: var(--c-gold); border-color: var(--c-gold); color: #000; }

        /* è·¯çº¿ç­–å±•ç›¸å…³æ ·å¼ */
        .routes-section {
            padding: 120px 0 80px;
            text-align: center;
        }
        
        /* åŸå¸‚è®°å¿†äº¤äº’ */
        .city-memory {
            display: block;
        }
        
        .route-details-section {
            display: none;
            margin-top: 60px;
        }
        
        .route-details-section.active {
            display: block;
        }
        
        .back-btn {
            display: inline-block;
            background: var(--c-paper);
            color: var(--c-ink);
            padding: 10px 25px;
            border-radius: 4px;
            text-decoration: none;
            transition: all 0.3s ease;
            margin-bottom: 30px;
            border: 1px solid #e0ded6;
        }
        
        .back-btn:hover {
            background: var(--c-gray);
            color: white;
        }
        
        /* è®°å¿†å¡ç‰‡æ‚¬åœæ•ˆæœå¢å¼º */
        .memory-item {
            transition: all 0.3s ease;
        }
        
        .memory-item:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        
        /* é›†ç« æ¸¸æˆæ ·å¼ */
        .stamp-section {
            margin: 80px 0;
            padding: 60px 0;
            background: var(--c-paper);
        }
        
        .stamp-title {
            font-family: var(--f-title);
            font-size: 2.5rem;
            color: var(--c-red);
            margin-bottom: 40px;
            text-align: center;
        }
        
        .stamps-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 30px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .stamp-item {
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }
        
        .stamp-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }
        
        .stamp-image {
            width: 100px;
            height: 100px;
            margin: 0 auto 15px;
            background: #f0f0f0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: #ccc;
            transition: all 0.3s ease;
        }
        
        .stamp-item.collected .stamp-image {
            background: linear-gradient(135deg, var(--c-red), var(--c-gold));
            color: white;
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(142, 53, 74, 0.3);
        }
        
        .stamp-name {
            font-size: 1rem;
            color: var(--c-ink);
            margin-bottom: 5px;
        }
        
        .stamp-status {
            font-size: 0.9rem;
            color: var(--c-gray);
        }
        
        .stamp-item.collected .stamp-status {
            color: var(--c-red);
            font-weight: bold;
        }
        
        .stamp-progress {
            text-align: center;
            margin: 40px 0;
            font-size: 1.2rem;
            color: var(--c-ink);
        }
        
        .progress-bar {
            width: 80%;
            max-width: 600px;
            height: 20px;
            background: #e0ded6;
            border-radius: 10px;
            margin: 20px auto;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--c-red), var(--c-gold));
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }
        
        .collect-all-btn {
            display: inline-block;
            background: var(--c-red);
            color: white;
            padding: 12px 40px;
            border-radius: 4px;
            text-decoration: none;
            transition: all 0.3s ease;
            margin-top: 20px;
            border: none;
            font-family: var(--f-body);
            font-size: 1rem;
            cursor: pointer;
        }
        
        .collect-all-btn:hover {
            background: var(--c-gold);
            transform: translateY(-2px);
        }
        
        /* AIè¯­éŸ³å¯¼æ¸¸æ ·å¼ */
        .voice-guide {
            margin: 40px 0;
            padding: 30px;
            background: var(--c-paper);
            border-radius: 8px;
            border: 1px solid #e0ded6;
        }
        
        .voice-guide-title {
            font-size: 1.2rem;
            color: var(--c-ink);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .voice-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .voice-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: white;
            border: 1px solid #e0ded6;
            border-radius: 50px;
            cursor: pointer;
            font-family: var(--f-body);
            font-size: 0.9rem;
            color: var(--c-ink);
            transition: all 0.3s ease;
        }
        
        .voice-btn:hover {
            background: var(--c-red);
            color: white;
            border-color: var(--c-red);
        }
        
        .voice-btn.active {
            background: var(--c-red);
            color: white;
            border-color: var(--c-red);
        }
        
        .voice-slider {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .voice-slider label {
            font-size: 0.9rem;
            color: var(--c-gray);
        }
        
        .voice-slider input[type="range"] {
            width: 150px;
            accent-color: var(--c-red);
        }
        
        .voice-status {
            margin-top: 15px;
            font-size: 0.9rem;
            color: var(--c-gray);
        }
        
        /* è¯­éŸ³æ’­æ”¾åŠ¨ç”» */
        .voice-wave {
            display: flex;
            align-items: center;
            gap: 3px;
            height: 12px;
        }
        
        .voice-bar {
            width: 2px;
            height: 100%;
            background-color: currentColor;
            animation: none;
        }
        
        .voice-btn.playing .voice-bar {
            animation: voiceWave 1s infinite ease-in-out;
        }
        
        .voice-btn.playing .voice-bar:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .voice-btn.playing .voice-bar:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        .voice-btn.playing .voice-bar:nth-child(4) {
            animation-delay: 0.1s;
        }
        
        @keyframes voiceWave {
            0%, 100% { height: 20%; }
            50% { height: 100%; }
        }
        
        /* è™šæ‹Ÿæ¼«æ¸¸æ ·å¼ */
        .virtual-tour {
            margin: 40px 0;
            padding: 30px;
            background: var(--c-paper);
            border-radius: 8px;
            border: 1px solid #e0ded6;
        }
        
        .virtual-tour-title {
            font-size: 1.2rem;
            color: var(--c-ink);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .panorama-container {
            position: relative;
            width: 100%;
            height: 400px;
            background: #f0f0f0;
            border-radius: 8px;
            overflow: hidden;
            cursor: grab;
        }
        
        .panorama-container:active {
            cursor: grabbing;
        }
        
        .panorama-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 200%; /* 2å€å®½åº¦å®ç°å…¨æ™¯æ•ˆæœ */
            height: 100%;
            background-size: cover;
            background-position: center;
            transition: transform 0.1s ease;
        }
        
        .panorama-controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            background: rgba(0, 0, 0, 0.6);
            padding: 10px 20px;
            border-radius: 30px;
            z-index: 10;
        }
        
        .panorama-btn {
            background: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .panorama-btn:hover {
            background: var(--c-red);
            color: white;
            transform: scale(1.1);
        }
        
        .hotspot {
            position: absolute;
            width: 20px;
            height: 20px;
            background: var(--c-red);
            border: 3px solid white;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 5;
            animation: pulse 2s infinite;
        }
        
        .hotspot:hover {
            transform: scale(1.3);
            box-shadow: 0 0 20px var(--c-red);
        }
        
        .hotspot::after {
            content: attr(data-label);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            margin-bottom: 5px;
        }
        
        .hotspot:hover::after {
            opacity: 1;
            visibility: visible;
        }
        
        .hotspot-info {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 8px;
            max-width: 300px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            z-index: 15;
            display: none;
        }
        
        .hotspot-info.active {
            display: block;
        }
        
        .hotspot-info h4 {
            color: var(--c-red);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .hotspot-info p {
            color: var(--c-ink);
            font-size: 0.9rem;
            line-height: 1.6;
        }
        
        /* è·¯çº¿è¯¦æƒ…ç›¸å…³æ ·å¼ */
        .route-details-section {
            display: none;
            margin-top: 60px;
        }
        
        .route-details-section.active {
            display: block;
        }
        
        .route-card {
            background: #fff;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }
        
        .route-image {
            height: 250px;
            background-size: cover;
            background-position: center;
            position: relative;
            overflow: hidden;
        }
        
        /* ä½¿ç”¨æœ¬åœ°å›¾ç‰‡ */
        #literature-route .route-image {
            background-image: url('image/wansongta.png');
        }
        
        #jiangnan-route .route-image {
            background-image: url('image/jiangnan-bamboo-01.jpg');
        }
        
        #ditan-route .route-image {
            background-image: url('image/ditan-courtyard-03.jpg');
        }
        
        /* è·¯çº¿ç¼–å· */
        .route-number {
            position: absolute;
            top: 20px;
            left: 20px;
            background: var(--c-red);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        /* è·¯çº¿å†…å®¹ */
        .route-content {
            padding: 30px;
        }
        
        .route-title {
            font-size: 1.8rem;
            color: var(--c-ink);
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .route-subtitle {
            font-size: 1rem;
            color: var(--c-gray);
            margin-bottom: 20px;
        }
        
        .route-duration {
            display: inline-block;
            background: var(--c-gold);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-bottom: 20px;
        }
        
        .route-description {
            color: #666;
            margin-bottom: 25px;
            line-height: 1.7;
        }
        
        .route-highlights {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 25px;
        }
        
        .highlight-tag {
            background: var(--c-paper);
            color: var(--c-ink);
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            border: 1px solid #e0ded6;
        }
        
        /* æŸ¥çœ‹æŒ‰é’® */
        .view-btn {
            display: inline-block;
            background: var(--c-red);
            color: white;
            padding: 12px 30px;
            border-radius: 4px;
            text-decoration: none;
            transition: all 0.3s ease;
            font-weight: bold;
        }
        
        .view-btn:hover {
            background: #732a3c;
            transform: translateY(-2px);
        }
        
        /* åŠ¨ç”» */
        @keyframes pulse { 0% { opacity: 0.8; transform: scale(1); } 100% { opacity: 0; transform: scale(3); } }
        .reveal { opacity: 0; transform: translateY(30px); transition: all 0.8s ease; }
        .reveal.active { opacity: 1; transform: translateY(0); }

        @media (max-width: 768px) {
            .hero-title { font-size: 3rem; }
            .article-block, .article-block.reverse { grid-template-columns: 1fr; direction: ltr; }
            .project-img { height: 300px; }
            .menu { display: none; }
        }
    </style>
</head>
<body>

    <div id="intro-overlay">
        <div class="intro-text">åŒ—å¹³é£ç‰©è®°</div>
        <p style="opacity: 0.7; letter-spacing: 2px; margin-top: 20px;">æˆ´ä¸Šè€³æœº Â· è†å¬åŸå¸‚å›å“</p>
        <button class="btn-enter" onclick="enterSite()">å¼€å¯æ¼«æ¸¸</button>
        <!-- å¯¼å…¥é¡µéŸ³ä¹æ§åˆ¶å›¾æ ‡ -->
        <button id="intro-audio-btn" class="ambient-btn" style="display: flex; align-items: center; gap: 10px; padding: 10px 20px; background: rgba(255, 255, 255, 0.6); border: 1px solid rgba(255, 255, 255, 0.8); border-radius: 50px; cursor: pointer; font-family: var(--f-body); font-size: 0.9rem; color: var(--c-paper); transition: all 0.3s ease; backdrop-filter: blur(5px); margin-top: 30px; position: relative; z-index: 1;">
            <div class="sound-wave">
                <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
            </div>
            <span>èƒŒæ™¯éŸ³ä¹</span>
        </button>
    </div>

    <nav>
        <a href="index.html" class="logo">
            <img src="image/logo.png" alt="åŒ—å¹³é£ç‰©è®°" style="width: 40px; height: 40px; object-fit: contain;">
            <span style="margin-left: 10px; font-family: var(--f-title); font-size: 1.5rem; color: var(--c-red);">åŒ—å¹³é£ç‰©è®°</span>
        </a>
        <div class="menu">
            <a href="index.html" class="menu-item">é¦–é¡µ</a>
            <a href="map.html" class="menu-item">æ¼«æ¸¸åœ°å›¾</a>
            <div class="menu-item">
                è·¯çº¿ç­–å±•
                <div class="dropdown">
                    <a href="literature-route.html">æ–‡å­¦ä¸å…‰é˜´</a>
                    <a href="jiangnan-route.html">åŒ—å¹³æ±Ÿå—</a>
                    <a href="ditan-route.html">ä¸åœ°å›åŒå‘¼å¸</a>
                </div>
            </div>
            <a href="about.html" class="menu-item">å…³äºæˆ‘ä»¬</a>
        </div>
    </nav>

    <header id="hero">
        <div class="hero-content">
            <h1 class="hero-title">è§¦æ‘¸<br>åŸå¸‚çš„<br>æŒçº¹</h1>
        </div>
    </header>



    <!-- éŸ³é¢‘æ§åˆ¶ -->
    <audio id="background-audio" loop>
        <source src="audio/beijingyinyue.mp3" type="audio/mpeg">
        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾
    </audio>

    <div class="audio-control" style="position: fixed; bottom: 20px; right: 20px; z-index: 1000;">
        <button id="audio-btn" class="ambient-btn" style="display: flex; align-items: center; gap: 10px; padding: 10px 20px; background: rgba(255, 255, 255, 0.9); border: 1px solid var(--c-gray); border-radius: 50px; cursor: pointer; font-family: var(--f-body); font-size: 0.9rem; color: var(--c-ink); transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);">
            <div class="sound-wave">
                <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
            </div>
            <span>æ²‰æµ¸ Â· åŸå¸‚å£°éŸ³</span>
        </button>
    </div>
    
    <div id="ai-assistant" style="position: fixed; bottom: 20px; right: 150px; z-index: 1000;">
        <button id="ai-btn" style="display: flex; align-items: center; gap: 10px; padding: 10px 20px; background: rgba(255, 255, 255, 0.9); border: 1px solid var(--c-gray); border-radius: 50px; cursor: pointer; font-family: var(--f-body); font-size: 0.9rem; color: var(--c-ink); transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);">
            <span style="font-size: 1.2rem;">ğŸ¤–</span>
            <span>æ™ºèƒ½åŠ©æ‰‹</span>
        </button>
        
        <div id="ai-chat" style="position: absolute; bottom: 60px; right: 0; width: 350px; max-height: 400px; background: white; border-radius: 12px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); display: none; flex-direction: column; overflow: hidden; z-index: 1001;">
            <div style="background: var(--c-red); color: white; padding: 15px; text-align: center; font-weight: bold;">
                åŒ—å¹³æ–‡åŒ–æ™ºèƒ½åŠ©æ‰‹
            </div>
            
            <div id="chat-messages" style="flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; height: 250px;">
                <div style="background: var(--c-paper); padding: 10px 15px; border-radius: 18px 18px 18px 5px; align-self: flex-start; max-width: 80%;">
                    <p style="margin: 0; color: var(--c-ink);">æ‚¨å¥½ï¼æˆ‘æ˜¯åŒ—å¹³é£ç‰©å›ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®æ‚¨äº†è§£çš„ï¼Ÿ</p>
                </div>
            </div>
            
            <div style="padding: 15px; border-top: 1px solid #eee; background: #fff;">
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="chat-input" placeholder="è¾“å…¥æ‚¨çš„é—®é¢˜..." style="flex: 1; padding: 10px 15px; border: 1px solid #ddd; border-radius: 25px; font-family: var(--f-body); outline: none;">
                    <button id="send-btn" style="padding: 10px 15px; background: var(--c-red); color: white; border: none; border-radius: 50%; cursor: pointer; font-size: 1.2rem; transition: 0.2s;">
                        â¤
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- è·¯çº¿ç­–å±•é¡µé¢ -->
    <section class="routes-section">
        <div class="container">
            <h2 class="section-title">è·¯çº¿ç­–å±•</h2>
            <p class="section-subtitle">æ¢ç´¢åŒ—å¹³çš„æ–‡åŒ–è„‰ç»œï¼Œæ„Ÿå—å†å²ä¸ç°ä»£çš„äº¤è</p>
            
            <!-- åŸå¸‚è®°å¿†æ¿å— -->
            <section class="city-memory" style="padding: 60px 0; background: var(--c-paper); text-align: center;">
                <h2 style="font-family: var(--f-title); font-size: 3rem; color: var(--c-red); margin-bottom: 40px;">åŸå¸‚è®°å¿†</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; margin-bottom: 60px;">
                    <div class="memory-item" style="cursor: pointer; transition: transform 0.3s ease; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 10px 30px rgba(0,0,0,0.05);">
                        <img src="image/wansongta.png" alt="ä¸‡æ¾è€äººå¡”" style="width: 100%; height: 200px; object-fit: cover; border-radius: 4px; margin-bottom: 20px;">
                        <h3 style="font-size: 1.4rem; color: var(--c-ink); margin-bottom: 10px;">æ–‡å­¦ä¸å…‰é˜´çš„äº¤é”™</h3>
                        <p style="color: var(--c-gray); line-height: 1.6;">ä»å¤å¡”åˆ°è—ä¹¦æ¥¼çš„åŒ—å¹³ä¸‰é‡æ—¶é—´ï¼Œæ¢ç´¢åŒ—äº¬çš„æ–‡å­¦ä¸å†å²è®°å¿†ï¼Œæ„Ÿå—æ—¶é—´çš„æµè½¬ä¸æ–‡æ˜çš„ä¼ æ‰¿ã€‚</p>
                    </div>
                    <div class="memory-item" style="cursor: pointer; transition: transform 0.3s ease; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 10px 30px rgba(0,0,0,0.05);">
                        <img src="image/jiangnan-bamboo-01.jpg" alt="åŒ—å¹³æ±Ÿå—" style="width: 100%; height: 200px; object-fit: cover; border-radius: 4px; margin-bottom: 20px;">
                        <h3 style="font-size: 1.4rem; color: var(--c-ink); margin-bottom: 10px;">åŒ—äº¬çš„æ±Ÿå—çƒŸé›¨</h3>
                        <p style="color: var(--c-gray); line-height: 1.6;">ä½“éªŒåŒ—æ–¹çš„æ±Ÿå—æ°´ä¹¡é£æƒ…ï¼Œåœ¨ç´«ç«¹é™¢ä¸­æ„Ÿå—çš‡å®¶å›­æ—çš„å—æ¸¡æ¢¦å½±ï¼Œæ¢ç´¢å‹è´¤å±±é¦†ã€ç¿ æ± ç­‰æ™¯ç‚¹ã€‚</p>
                    </div>
                    <div class="memory-item" style="cursor: pointer; transition: transform 0.3s ease; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 10px 30px rgba(0,0,0,0.05);">
                        <img src="image/ditan-courtyard-03.jpg" alt="ä¸åœ°å›åŒå‘¼å¸" style="width: 100%; height: 200px; object-fit: cover; border-radius: 4px; margin-bottom: 20px;">
                        <h3 style="font-size: 1.4rem; color: var(--c-ink); margin-bottom: 10px;">ä¸åœ°å›åŒå‘¼å¸</h3>
                        <p style="color: var(--c-gray); line-height: 1.6;">è·Ÿéšå²é“ç”Ÿçš„è„šæ­¥æ¢ç´¢åœ°å›çš„æ–‡å­¦ä¸ç”Ÿå‘½æ„ä¹‰ï¼Œåœ¨å¯‚é™ä¸­å¬è§ç”Ÿå‘½çš„å›å“ï¼Œæ„Ÿå—ç”Ÿå‘½çš„æ²‰æ€ä¸åŠ›é‡ã€‚</p>
                    </div>
                </div>
            </section>
            
            <!-- é›†ç« æ¸¸æˆæ¿å— -->
            <section class="stamp-section">
                <div class="container">
                    <h2 class="stamp-title">åŸå¸‚è®°å¿†é›†ç« </h2>
                    <div class="stamp-progress">
                        <p>å·²æ”¶é›† <span id="stamp-count">0</span>/5 ä¸ªå°ç« </p>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill"></div>
                        </div>
                    </div>
                    
                    <div class="stamps-grid">
                        <!-- å°ç« 1ï¼šæ–‡å­¦ä¸å…‰é˜´ -->
                        <div class="stamp-item" data-stamp="literature">
                            <div class="stamp-image">ğŸ“œ</div>
                            <h3 class="stamp-name">æ–‡å­¦ä¸å…‰é˜´</h3>
                            <p class="stamp-status">æœªæ”¶é›†</p>
                        </div>
                        
                        <!-- å°ç« 2ï¼šæ±Ÿå—çƒŸé›¨ -->
                        <div class="stamp-item" data-stamp="jiangnan">
                            <div class="stamp-image">ğŸŒ§ï¸</div>
                            <h3 class="stamp-name">æ±Ÿå—çƒŸé›¨</h3>
                            <p class="stamp-status">æœªæ”¶é›†</p>
                        </div>
                        
                        <!-- å°ç« 3ï¼šä¸åœ°å›åŒå‘¼å¸ -->
                        <div class="stamp-item" data-stamp="ditan">
                            <div class="stamp-image">ğŸŒ³</div>
                            <h3 class="stamp-name">ä¸åœ°å›åŒå‘¼å¸</h3>
                            <p class="stamp-status">æœªæ”¶é›†</p>
                        </div>
                        
                        <!-- å°ç« 4ï¼šåŸå¸‚æ¢ç´¢è€… -->
                        <div class="stamp-item" data-stamp="explorer">
                            <div class="stamp-image">ğŸ§­</div>
                            <h3 class="stamp-name">åŸå¸‚æ¢ç´¢è€…</h3>
                            <p class="stamp-status">æœªæ”¶é›†</p>
                        </div>
                        
                        <!-- å°ç« 5ï¼šæ–‡åŒ–ä¼ æ‰¿è€… -->
                        <div class="stamp-item" data-stamp="heritage">
                            <div class="stamp-image">ğŸ›ï¸</div>
                            <h3 class="stamp-name">æ–‡åŒ–ä¼ æ‰¿è€…</h3>
                            <p class="stamp-status">æœªæ”¶é›†</p>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 40px;">
                        <button class="collect-all-btn" onclick="collectAllStamps()">ä¸€é”®æ”¶é›†æ‰€æœ‰å°ç« </button>
                        <p style="margin-top: 20px; color: var(--c-gray); font-size: 0.9rem;">æ¢ç´¢ä¸åŒè·¯çº¿ï¼Œæ”¶é›†æ›´å¤šå°ç« å§ï¼</p>
                    </div>
                </div>
            </section>

            <!-- è·¯çº¿è¯¦æƒ…åŒºåŸŸ -->
            <!-- è·¯çº¿1ï¼šæ–‡å­¦ä¸å…‰é˜´çš„äº¤é”™è¯¦æƒ… -->
            <section class="route-details-section" id="literature-details">
                <a href="#" class="back-btn" onclick="showCityMemory()">â† è¿”å›åŸå¸‚è®°å¿†</a>
                <div class="route-card" style="max-width: 800px; margin: 0 auto;">
                    <div class="route-image">
                        <div class="route-number">01</div>
                    </div>
                    <div class="route-content">
                        <h3 class="route-title">æ–‡å­¦ä¸å…‰é˜´çš„äº¤é”™</h3>
                        <p class="route-subtitle">ä»å¤å¡”åˆ°è—ä¹¦æ¥¼çš„åŒ—å¹³ä¸‰é‡æ—¶é—´</p>
                        <span class="route-duration">2-3å°æ—¶</span>
                        <p class="route-description">æ¢ç´¢åŒ—äº¬çš„æ–‡å­¦ä¸å†å²è®°å¿†ï¼Œä»ä¸‡æ¾è€äººå¡”åˆ°æ­£é˜³ä¹¦å±€ï¼Œå†åˆ°çº¢æ¥¼è—ä¹¦æ¥¼ï¼Œæ„Ÿå—æ—¶é—´çš„æµè½¬ä¸æ–‡æ˜çš„ä¼ æ‰¿ã€‚</p>
                        <div class="route-highlights">
                            <span class="highlight-tag">ä¸‡æ¾è€äººå¡”</span>
                            <span class="highlight-tag">æ­£é˜³ä¹¦å±€</span>
                            <span class="highlight-tag">çº¢æ¥¼è—ä¹¦æ¥¼</span>
                        </div>
                        
                        <!-- AIè¯­éŸ³å¯¼æ¸¸ -->
                        <div class="voice-guide">
                            <h4 class="voice-guide-title">ğŸ¤– AIè¯­éŸ³å¯¼æ¸¸</h4>
                            <div class="voice-controls">
                                <button class="voice-btn" id="play-btn-literature" onclick="toggleVoiceGuide('literature')">
                                    <span>â–¶ï¸</span>
                                    <span>æ’­æ”¾è®²è§£</span>
                                    <div class="voice-wave">
                                        <div class="voice-bar"></div>
                                        <div class="voice-bar"></div>
                                        <div class="voice-bar"></div>
                                        <div class="voice-bar"></div>
                                    </div>
                                </button>
                                <button class="voice-btn" onclick="stopVoiceGuide()">
                                    <span>â¹ï¸</span>
                                    <span>åœæ­¢è®²è§£</span>
                                </button>
                                <div class="voice-slider">
                                    <label for="rate-slider">è¯­é€Ÿ:</label>
                                    <input type="range" id="rate-slider" min="0.5" max="2" step="0.1" value="1">
                                    <span id="rate-value">1.0</span>
                                </div>
                            </div>
                            <div class="voice-status" id="voice-status-literature">
                                ç‚¹å‡»æ’­æ”¾æŒ‰é’®ï¼Œè†å¬è·¯çº¿è®²è§£
                            </div>
                        </div>
                        
                        <!-- è™šæ‹Ÿæ¼«æ¸¸ -->
                        <div class="virtual-tour">
                            <h4 class="virtual-tour-title">ğŸ—ºï¸ è™šæ‹Ÿæ¼«æ¸¸</h4>
                            <div class="panorama-container" id="panorama-literature">
                                <div class="panorama-image" style="background-image: url('image/wansongta.png')"></div>
                                
                                <!-- çƒ­ç‚¹æ ‡è®° -->
                                <div class="hotspot" data-label="ä¸‡æ¾è€äººå¡”" style="top: 40%; left: 30%;" data-info="ä¸‡æ¾è€äººå¡”æ˜¯ä¸€åº§å…«è§’ä¹çº§å¯†æªå¡”ï¼Œå·²ç»é™ç«‹äº†å…«ç™¾å¤šå¹´ï¼Œæ˜¯é‡‘å…ƒä¹‹é™…ç¦…å®—å·¨åŒ ä¸‡æ¾è¡Œç§€çš„çºªå¿µå¡”ã€‚"></div>
                                <div class="hotspot" data-label="æ­£é˜³ä¹¦å±€" style="top: 50%; left: 50%;" data-info="æ­£é˜³ä¹¦å±€æ˜¯åŒ—äº¬å”¯ä¸€ä¸€å®¶ä¸“è¥åŒ—äº¬åœ°æ–¹æ–‡çŒ®çš„æ—§ä¹¦åº—ï¼Œåœ¨è¿™é‡Œä½ å¯ä»¥æ‰¾åˆ°å¤§é‡å…³äºåŒ—äº¬å†å²ã€åœ°ç†ã€æ°‘ä¿—çš„ä¹¦ç±ã€‚"></div>
                                <div class="hotspot" data-label="çº¢æ¥¼è—ä¹¦æ¥¼" style="top: 60%; left: 70%;" data-info="çº¢æ¥¼è—ä¹¦æ¥¼çš„å‰èº«æ˜¯çº¢æ¥¼ç”µå½±é™¢ï¼Œ2018å¹´è½¬å‹ä¸ºå…¬å…±è—ä¹¦æ¥¼ï¼Œå®Œç¾æ¼”ç»äº†'æ—§ç“¶è£…æ–°é…’'çš„ç†å¿µã€‚"></div>
                                
                                <!-- çƒ­ç‚¹ä¿¡æ¯é¢æ¿ -->
                                <div class="hotspot-info" id="hotspot-info">
                                    <h4 id="hotspot-title"></h4>
                                    <p id="hotspot-content"></p>
                                </div>
                                
                                <!-- å…¨æ™¯æ§åˆ¶æŒ‰é’® -->
                                <div class="panorama-controls">
                                    <button class="panorama-btn" onclick="panoramaMove('literature', -10)" title="å‘å·¦ç§»åŠ¨">
                                        â†
                                    </button>
                                    <button class="panorama-btn" onclick="panoramaMove('literature', 10)" title="å‘å³ç§»åŠ¨">
                                        â†’
                                    </button>
                                    <button class="panorama-btn" onclick="panoramaZoom('literature', 1.1)" title="æ”¾å¤§">
                                        ğŸ”+
                                    </button>
                                    <button class="panorama-btn" onclick="panoramaZoom('literature', 0.9)" title="ç¼©å°">
                                        ğŸ”-
                                    </button>
                                    <button class="panorama-btn" onclick="panoramaReset('literature')" title="é‡ç½®">
                                        ğŸ”„
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <a href="literature-route.html" class="view-btn">è¿›å…¥å®Œæ•´è·¯çº¿</a>
                    </div>
                </div>
            </section>
            
            <!-- è·¯çº¿2ï¼šåŒ—äº¬çš„æ±Ÿå—çƒŸé›¨è¯¦æƒ… -->
            <section class="route-details-section" id="jiangnan-details">
                <a href="#" class="back-btn" onclick="showCityMemory()">â† è¿”å›åŸå¸‚è®°å¿†</a>
                <div class="route-card" style="max-width: 800px; margin: 0 auto;">
                    <div class="route-image">
                        <div class="route-number">02</div>
                    </div>
                    <div class="route-content">
                        <h3 class="route-title">åŒ—äº¬çš„æ±Ÿå—çƒŸé›¨</h3>
                        <p class="route-subtitle">ä¸€åº§çš‡å®¶å›­æ—çš„å—æ¸¡æ¢¦å½±</p>
                        <span class="route-duration">3-4å°æ—¶</span>
                        <p class="route-description">ä½“éªŒåŒ—æ–¹çš„æ±Ÿå—æ°´ä¹¡é£æƒ…ï¼Œåœ¨ç´«ç«¹é™¢ä¸­æ„Ÿå—çš‡å®¶å›­æ—çš„å—æ¸¡æ¢¦å½±ï¼Œæ¢ç´¢å‹è´¤å±±é¦†ã€ç¿ æ± ã€é—®æœˆæ¥¼ç­‰æ™¯ç‚¹ã€‚</p>
                        <div class="route-highlights">
                            <span class="highlight-tag">å‹è´¤å±±é¦†</span>
                            <span class="highlight-tag">ç¿ æ± </span>
                            <span class="highlight-tag">é—®æœˆæ¥¼</span>
                            <span class="highlight-tag">ç´«å¾¡æ¹¾ç å¤´</span>
                        </div>
                        
                        <!-- AIè¯­éŸ³å¯¼æ¸¸ -->
                        <div class="voice-guide">
                            <h4 class="voice-guide-title">ğŸ¤– AIè¯­éŸ³å¯¼æ¸¸</h4>
                            <div class="voice-controls">
                                <button class="voice-btn" id="play-btn-jiangnan" onclick="toggleVoiceGuide('jiangnan')">
                                    <span>â–¶ï¸</span>
                                    <span>æ’­æ”¾è®²è§£</span>
                                    <div class="voice-wave">
                                        <div class="voice-bar"></div>
                                        <div class="voice-bar"></div>
                                        <div class="voice-bar"></div>
                                        <div class="voice-bar"></div>
                                    </div>
                                </button>
                                <button class="voice-btn" onclick="stopVoiceGuide()">
                                    <span>â¹ï¸</span>
                                    <span>åœæ­¢è®²è§£</span>
                                </button>
                                <div class="voice-slider">
                                    <label for="rate-slider">è¯­é€Ÿ:</label>
                                    <input type="range" id="rate-slider" min="0.5" max="2" step="0.1" value="1">
                                    <span id="rate-value">1.0</span>
                                </div>
                            </div>
                            <div class="voice-status" id="voice-status-jiangnan">
                                ç‚¹å‡»æ’­æ”¾æŒ‰é’®ï¼Œè†å¬è·¯çº¿è®²è§£
                            </div>
                        </div>
                        
                        <!-- è™šæ‹Ÿæ¼«æ¸¸ -->
                        <div class="virtual-tour">
                            <h4 class="virtual-tour-title">ğŸ—ºï¸ è™šæ‹Ÿæ¼«æ¸¸</h4>
                            <div class="panorama-container" id="panorama-jiangnan">
                                <div class="panorama-image" style="background-image: url('image/jiangnan-bamboo-01.jpg')"></div>
                                
                                <!-- çƒ­ç‚¹æ ‡è®° -->
                                <div class="hotspot" data-label="å‹è´¤å±±é¦†" style="top: 40%; left: 30%;" data-info="å‹è´¤å±±é¦†æ˜¯ä¸€åº§ä»¿æ±Ÿå—æ°‘å±…çš„é™¢è½ï¼Œå¸¸è®¾æ±Ÿå—ä¹¦ç”»å±•ã€‚"></div>
                                <div class="hotspot" data-label="ç¿ æ± " style="top: 50%; left: 50%;" data-info="ç¿ æ± æ˜¯å…¨å›­ç«¹æ™¯çš„ç²¾åï¼Œä¹Ÿæ˜¯'çƒŸé›¨'æ°”è´¨çš„æºæ³‰ã€‚"></div>
                                <div class="hotspot" data-label="é—®æœˆæ¥¼" style="top: 60%; left: 70%;" data-info="ä»é—®æœˆæ¥¼å¯ä»¥ä¿¯ç°å…¨å›­æ™¯è‰²ï¼Œæ˜¯è§‚æ™¯çš„ç»ä½³ä½ç½®ã€‚"></div>
                                
                                <!-- çƒ­ç‚¹ä¿¡æ¯é¢æ¿ -->
                                <div class="hotspot-info" id="hotspot-info-jiangnan">
                                    <h4 id="hotspot-title-jiangnan"></h4>
                                    <p id="hotspot-content-jiangnan"></p>
                                </div>
                                
                                <!-- å…¨æ™¯æ§åˆ¶æŒ‰é’® -->
                                <div class="panorama-controls">
                                    <button class="panorama-btn" onclick="panoramaMove('jiangnan', -10)" title="å‘å·¦ç§»åŠ¨">
                                        â†
                                    </button>
                                    <button class="panorama-btn" onclick="panoramaMove('jiangnan', 10)" title="å‘å³ç§»åŠ¨">
                                        â†’
                                    </button>
                                    <button class="panorama-btn" onclick="panoramaZoom('jiangnan', 1.1)" title="æ”¾å¤§">
                                        ğŸ”+
                                    </button>
                                    <button class="panorama-btn" onclick="panoramaZoom('jiangnan', 0.9)" title="ç¼©å°">
                                        ğŸ”-
                                    </button>
                                    <button class="panorama-btn" onclick="panoramaReset('jiangnan')" title="é‡ç½®">
                                        ğŸ”„
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <a href="jiangnan-route.html" class="view-btn">è¿›å…¥å®Œæ•´è·¯çº¿</a>
                    </div>
                </div>
            </section>
            
            <!-- è·¯çº¿3ï¼šä¸åœ°å›åŒå‘¼å¸è¯¦æƒ… -->
            <section class="route-details-section" id="ditan-details">
                <a href="#" class="back-btn" onclick="showCityMemory()">â† è¿”å›åŸå¸‚è®°å¿†</a>
                <div class="route-card" style="max-width: 800px; margin: 0 auto;">
                    <div class="route-image">
                        <div class="route-number">03</div>
                    </div>
                    <div class="route-content">
                        <h3 class="route-title">ä¸åœ°å›åŒå‘¼å¸</h3>
                        <p class="route-subtitle">åœ¨å¯‚é™ä¸­ï¼Œå¬è§ç”Ÿå‘½çš„å›å“</p>
                        <span class="route-duration">2-3å°æ—¶</span>
                        <p class="route-description">è·Ÿéšå²é“ç”Ÿçš„è„šæ­¥æ¢ç´¢åœ°å›çš„æ–‡å­¦ä¸ç”Ÿå‘½æ„ä¹‰ï¼Œåœ¨æ–¹æ³½å›ã€å¤æŸåŒºã€ç¥åº“ç­‰åœ°æ„Ÿå—ç”Ÿå‘½çš„æ²‰æ€ä¸åŠ›é‡ã€‚</p>
                        <div class="route-highlights">
                            <span class="highlight-tag">æ–¹æ³½å›</span>
                            <span class="highlight-tag">å¤æŸåŒº</span>
                            <span class="highlight-tag">ç¥åº“</span>
                            <span class="highlight-tag">æˆ‘ä¸åœ°å›ä¹¦åº—</span>
                        </div>
                        
                        <!-- AIè¯­éŸ³å¯¼æ¸¸ -->
                        <div class="voice-guide">
                            <h4 class="voice-guide-title">ğŸ¤– AIè¯­éŸ³å¯¼æ¸¸</h4>
                            <div class="voice-controls">
                                <button class="voice-btn" id="play-btn-ditan" onclick="toggleVoiceGuide('ditan')">
                                    <span>â–¶ï¸</span>
                                    <span>æ’­æ”¾è®²è§£</span>
                                    <div class="voice-wave">
                                        <div class="voice-bar"></div>
                                        <div class="voice-bar"></div>
                                        <div class="voice-bar"></div>
                                        <div class="voice-bar"></div>
                                    </div>
                                </button>
                                <button class="voice-btn" onclick="stopVoiceGuide()">
                                    <span>â¹ï¸</span>
                                    <span>åœæ­¢è®²è§£</span>
                                </button>
                                <div class="voice-slider">
                                    <label for="rate-slider">è¯­é€Ÿ:</label>
                                    <input type="range" id="rate-slider" min="0.5" max="2" step="0.1" value="1">
                                    <span id="rate-value">1.0</span>
                                </div>
                            </div>
                            <div class="voice-status" id="voice-status-ditan">
                                ç‚¹å‡»æ’­æ”¾æŒ‰é’®ï¼Œè†å¬è·¯çº¿è®²è§£
                            </div>
                        </div>
                        
                        <!-- è™šæ‹Ÿæ¼«æ¸¸ -->
                        <div class="virtual-tour">
                            <h4 class="virtual-tour-title">ğŸ—ºï¸ è™šæ‹Ÿæ¼«æ¸¸</h4>
                            <div class="panorama-container" id="panorama-ditan">
                                <div class="panorama-image" style="background-image: url('image/ditan-courtyard-03.jpg')"></div>
                                
                                <!-- çƒ­ç‚¹æ ‡è®° -->
                                <div class="hotspot" data-label="æ–¹æ³½å›" style="top: 40%; left: 30%;" data-info="æ–¹æ³½å›æ˜¯çš‡å¸ç¥­ç¥€'çš‡åœ°ç¥‡'çš„ç¥åœ£å›åŸã€‚"></div>
                                <div class="hotspot" data-label="å¤æŸåŒº" style="top: 50%; left: 50%;" data-info="è¿™é‡Œçš„å¤æŸå·²æœ‰ä¸‰å››ç™¾å¹´å†å²ï¼Œè§è¯äº†åœ°å›çš„æ²§æ¡‘å˜è¿ã€‚"></div>
                                <div class="hotspot" data-label="ç¥åº“" style="top: 60%; left: 70%;" data-info="ç¥åº“æ›¾å­˜æ”¾ç¥ç‰Œä¸ç¤¼å™¨ï¼Œæ˜¯åœ°å›çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚"></div>
                                
                                <!-- çƒ­ç‚¹ä¿¡æ¯é¢æ¿ -->
                                <div class="hotspot-info" id="hotspot-info-ditan">
                                    <h4 id="hotspot-title-ditan"></h4>
                                    <p id="hotspot-content-ditan"></p>
                                </div>
                                
                                <!-- å…¨æ™¯æ§åˆ¶æŒ‰é’® -->
                                <div class="panorama-controls">
                                    <button class="panorama-btn" onclick="panoramaMove('ditan', -10)" title="å‘å·¦ç§»åŠ¨">
                                        â†
                                    </button>
                                    <button class="panorama-btn" onclick="panoramaMove('ditan', 10)" title="å‘å³ç§»åŠ¨">
                                        â†’
                                    </button>
                                    <button class="panorama-btn" onclick="panoramaZoom('ditan', 1.1)" title="æ”¾å¤§">
                                        ğŸ”+
                                    </button>
                                    <button class="panorama-btn" onclick="panoramaZoom('ditan', 0.9)" title="ç¼©å°">
                                        ğŸ”-
                                    </button>
                                    <button class="panorama-btn" onclick="panoramaReset('ditan')" title="é‡ç½®">
                                        ğŸ”„
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <a href="ditan-route.html" class="view-btn">è¿›å…¥å®Œæ•´è·¯çº¿</a>
                    </div>
                </div>
            </section>
        </div>
    </section>

    <script>
        // å¼€åœºé€»è¾‘ - ç¡®ä¿åœ¨å…¨å±€ä½œç”¨åŸŸä¸­å®šä¹‰ï¼Œä»¥ä¾¿æŒ‰é’®çš„onclickäº‹ä»¶èƒ½å¤Ÿè°ƒç”¨å®ƒ
        function enterSite() {
            const overlay = document.getElementById('intro-overlay');
            overlay.style.opacity = '0';
            overlay.style.visibility = 'hidden';
            // ä¿æŒéŸ³ä¹æ’­æ”¾ï¼Œä¸ä¸­æ–­ç”¨æˆ·ä½“éªŒ
        }

        // é¡µé¢åŠ è½½ååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            console.log('éŸ³é¢‘å·²å‡†å¤‡å°±ç»ªï¼Œç­‰å¾…ç”¨æˆ·äº¤äº’');
            
            // éŸ³é¢‘æ§åˆ¶é€»è¾‘ - åœ¨DOMåŠ è½½å®Œæˆååˆå§‹åŒ–
            const audio = document.getElementById('background-audio');
            const audioBtn = document.getElementById('audio-btn');
            const introAudioBtn = document.getElementById('intro-audio-btn');
            let isPlaying = false;

            // éŸ³é¢‘æ§åˆ¶æŒ‰é’®åŠŸèƒ½
            function toggleAudio() {
                if (isPlaying) {
                    audio.pause();
                    if (audioBtn) audioBtn.classList.remove('playing');
                    if (introAudioBtn) introAudioBtn.classList.remove('playing');
                } else {
                    audio.play().then(() => {
                        if (audioBtn) audioBtn.classList.add('playing');
                        if (introAudioBtn) introAudioBtn.classList.add('playing');
                        isPlaying = true;
                    }).catch(error => {
                        console.log('éŸ³é¢‘æ’­æ”¾å¤±è´¥:', error);
                    });
                }
                isPlaying = !isPlaying;
            }

            // ä¸ºéŸ³é¢‘æ§åˆ¶æŒ‰é’®æ·»åŠ äº‹ä»¶ç›‘å¬
            if (audioBtn) {
                audioBtn.addEventListener('click', toggleAudio);
            }
            
            // ä¸ºå¯¼å…¥é¡µéŸ³é¢‘æ§åˆ¶æŒ‰é’®æ·»åŠ äº‹ä»¶ç›‘å¬
            if (introAudioBtn) {
                introAudioBtn.addEventListener('click', toggleAudio);
            }
        });

     
        // è·¯çº¿ç­–å±•åŠŸèƒ½
        
        // æ˜¾ç¤ºè·¯çº¿è¯¦æƒ…
        function showRouteDetails(routeId) {
            // éšè—åŸå¸‚è®°å¿†
            document.querySelector('.city-memory').style.display = 'none';
            
            // éšè—é›†ç« æ¸¸æˆ
            document.querySelector('.stamp-section').style.display = 'none';
            
            // éšè—æ‰€æœ‰è·¯çº¿è¯¦æƒ…
            const allDetails = document.querySelectorAll('.route-details-section');
            allDetails.forEach(section => {
                section.classList.remove('active');
            });
            
            // æ˜¾ç¤ºå¯¹åº”è·¯çº¿è¯¦æƒ…
            const targetDetails = document.getElementById(routeId);
            if (targetDetails) {
                targetDetails.classList.add('active');
            }
            
            // æ ¹æ®è·¯çº¿è‡ªåŠ¨æ”¶é›†å¯¹åº”å°ç« 
            if (routeId === 'literature-details') {
                collectStamp('literature');
            } else if (routeId === 'jiangnan-details') {
                collectStamp('jiangnan');
            } else if (routeId === 'ditan-details') {
                collectStamp('ditan');
            }
        }
        
        // æ˜¾ç¤ºåŸå¸‚è®°å¿†
        function showCityMemory() {
            // æ˜¾ç¤ºåŸå¸‚è®°å¿†
            document.querySelector('.city-memory').style.display = 'block';
            
            // æ˜¾ç¤ºé›†ç« æ¸¸æˆ
            document.querySelector('.stamp-section').style.display = 'block';
            
            // éšè—æ‰€æœ‰è·¯çº¿è¯¦æƒ…
            const allDetails = document.querySelectorAll('.route-details-section');
            allDetails.forEach(section => {
                section.classList.remove('active');
            });
            
            // æ›´æ–°é›†ç« è¿›åº¦
            updateStampProgress();
        }
        
        // ä¸ºåŸå¸‚è®°å¿†å¡ç‰‡æ·»åŠ ç‚¹å‡»äº‹ä»¶
        document.addEventListener('DOMContentLoaded', function() {
            // è·å–æ‰€æœ‰åŸå¸‚è®°å¿†å¡ç‰‡
            const memoryItems = document.querySelectorAll('.memory-item');
            
            // ä¸ºæ¯ä¸ªå¡ç‰‡æ·»åŠ ç‚¹å‡»äº‹ä»¶
            memoryItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    // æ ¹æ®å¡ç‰‡å†…å®¹ç¡®å®šè¦æ˜¾ç¤ºçš„è·¯çº¿è¯¦æƒ…
                    if (this.querySelector('h3').textContent.includes('æ–‡å­¦ä¸å…‰é˜´')) {
                        showRouteDetails('literature-details');
                    } else if (this.querySelector('h3').textContent.includes('æ±Ÿå—çƒŸé›¨')) {
                        showRouteDetails('jiangnan-details');
                    } else if (this.querySelector('h3').textContent.includes('ä¸åœ°å›åŒå‘¼å¸')) {
                        showRouteDetails('ditan-details');
                    }
                });
            });
            
            // åˆå§‹åŒ–é›†ç« æ¸¸æˆ
            initStampGame();
        });
        
        // é›†ç« æ¸¸æˆç›¸å…³å‡½æ•°
        
        // åˆå§‹åŒ–é›†ç« æ¸¸æˆ
        function initStampGame() {
            // ä»localStorageåŠ è½½é›†ç« çŠ¶æ€
            const stamps = JSON.parse(localStorage.getItem('beipingStamps')) || {};
            
            // æ›´æ–°æ‰€æœ‰å°ç« çš„æ˜¾ç¤ºçŠ¶æ€
            const stampItems = document.querySelectorAll('.stamp-item');
            stampItems.forEach(item => {
                const stampId = item.dataset.stamp;
                if (stamps[stampId]) {
                    item.classList.add('collected');
                    item.querySelector('.stamp-status').textContent = 'å·²æ”¶é›†';
                }
            });
            
            // æ›´æ–°é›†ç« è¿›åº¦
            updateStampProgress();
            
            // å¦‚æœæ‰€æœ‰è·¯çº¿éƒ½æ¢ç´¢è¿‡ï¼Œæ”¶é›†ç‰¹æ®Šå°ç« 
            if (stamps.literature && stamps.jiangnan && stamps.ditan) {
                collectStamp('explorer');
                // å¦‚æœæ”¶é›†äº†æ‰€æœ‰è·¯çº¿å°ç« ï¼Œæ”¶é›†æ–‡åŒ–ä¼ æ‰¿è€…å°ç« 
                if (stamps.explorer) {
                    collectStamp('heritage');
                }
            }
        }
        
        // æ”¶é›†å•ä¸ªå°ç« 
        function collectStamp(stampId) {
            // ä»localStorageåŠ è½½é›†ç« çŠ¶æ€
            const stamps = JSON.parse(localStorage.getItem('beipingStamps')) || {};
            
            // æ ‡è®°å°ç« ä¸ºå·²æ”¶é›†
            stamps[stampId] = true;
            
            // ä¿å­˜åˆ°localStorage
            localStorage.setItem('beipingStamps', JSON.stringify(stamps));
            
            // æ›´æ–°å¯¹åº”å°ç« çš„æ˜¾ç¤º
            const stampItem = document.querySelector(`[data-stamp="${stampId}"]`);
            if (stampItem) {
                stampItem.classList.add('collected');
                stampItem.querySelector('.stamp-status').textContent = 'å·²æ”¶é›†';
                
                // æ·»åŠ æ”¶é›†åŠ¨ç”»æ•ˆæœ
                stampItem.style.transform = 'scale(1.2)';
                setTimeout(() => {
                    stampItem.style.transform = '';
                }, 300);
            }
            
            // æ›´æ–°é›†ç« è¿›åº¦
            updateStampProgress();
        }
        
        // ä¸€é”®æ”¶é›†æ‰€æœ‰å°ç« 
        function collectAllStamps() {
            const stampIds = ['literature', 'jiangnan', 'ditan', 'explorer', 'heritage'];
            stampIds.forEach(stampId => {
                collectStamp(stampId);
            });
            
            // æ˜¾ç¤ºæˆåŠŸæç¤º
            alert('æ­å–œä½ æ”¶é›†äº†æ‰€æœ‰å°ç« ï¼');
        }
        
        // æ›´æ–°é›†ç« è¿›åº¦
        function updateStampProgress() {
            // ä»localStorageåŠ è½½é›†ç« çŠ¶æ€
            const stamps = JSON.parse(localStorage.getItem('beipingStamps')) || {};
            
            // è®¡ç®—å·²æ”¶é›†å°ç« æ•°é‡
            const collectedCount = Object.values(stamps).filter(Boolean).length;
            const totalCount = 5;
            
            // æ›´æ–°è¿›åº¦æ˜¾ç¤º
            document.getElementById('stamp-count').textContent = collectedCount;
            
            // æ›´æ–°è¿›åº¦æ¡
            const progressFill = document.getElementById('progress-fill');
            const progressPercentage = (collectedCount / totalCount) * 100;
            progressFill.style.width = `${progressPercentage}%`;
        }
        
        // AIè¯­éŸ³å¯¼æ¸¸ç›¸å…³å‡½æ•°
        
        // è·¯çº¿è®²è§£æ–‡æœ¬
        const routeExplanations = {
            literature: {
                title: "æ–‡å­¦ä¸å…‰é˜´çš„äº¤é”™",
                content: "æ¬¢è¿æ¥åˆ°æ–‡å­¦ä¸å…‰é˜´çš„äº¤é”™è·¯çº¿ã€‚è¿™æ¡è·¯çº¿ä»å¤å¡”åˆ°è—ä¹¦æ¥¼ï¼Œå±•ç°äº†åŒ—å¹³çš„ä¸‰é‡æ—¶é—´ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å°†å‚è§‚ä¸‡æ¾è€äººå¡”ï¼Œè¿™åº§å…«è§’ä¹çº§å¯†æªå¡”å·²ç»é™ç«‹äº†å…«ç™¾å¤šå¹´ï¼Œæ˜¯é‡‘å…ƒä¹‹é™…ç¦…å®—å·¨åŒ ä¸‡æ¾è¡Œç§€çš„çºªå¿µå¡”ã€‚æ¥ç€ï¼Œæˆ‘ä»¬å°†å‰å¾€æ­£é˜³ä¹¦å±€ï¼Œè¿™æ˜¯åŒ—äº¬å”¯ä¸€ä¸€å®¶ä¸“è¥åŒ—äº¬åœ°æ–¹æ–‡çŒ®çš„æ—§ä¹¦åº—ï¼Œåœ¨è¿™é‡Œä½ å¯ä»¥æ‰¾åˆ°å¤§é‡å…³äºåŒ—äº¬å†å²ã€åœ°ç†ã€æ°‘ä¿—çš„ä¹¦ç±ã€‚æœ€åï¼Œæˆ‘ä»¬å°†å‚è§‚çº¢æ¥¼è—ä¹¦æ¥¼ï¼Œå®ƒçš„å‰èº«æ˜¯çº¢æ¥¼ç”µå½±é™¢ï¼Œ2018å¹´è½¬å‹ä¸ºå…¬å…±è—ä¹¦æ¥¼ï¼Œå®Œç¾æ¼”ç»äº†'æ—§ç“¶è£…æ–°é…’'çš„ç†å¿µã€‚"
            },
            jiangnan: {
                title: "åŒ—äº¬çš„æ±Ÿå—çƒŸé›¨",
                content: "æ¬¢è¿æ¥åˆ°åŒ—äº¬çš„æ±Ÿå—çƒŸé›¨è·¯çº¿ã€‚è¿™æ¡è·¯çº¿ä½äºç´«ç«¹é™¢å…¬å›­ï¼Œè¿™é‡Œä»¿æ±Ÿå—æ„è¶£è¥å»ºï¼Œå±•ç°äº†åŒ—æ–¹çš„æ±Ÿå—æ°´ä¹¡é£æƒ…ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å°†å‚è§‚å‹è´¤å±±é¦†ï¼Œè¿™æ˜¯ä¸€åº§ä»¿æ±Ÿå—æ°‘å±…çš„é™¢è½ï¼Œå¸¸è®¾æ±Ÿå—ä¹¦ç”»å±•ã€‚æ¥ç€ï¼Œæˆ‘ä»¬å°†å‰å¾€ç¿ æ± ï¼Œè¿™æ˜¯å…¨å›­ç«¹æ™¯çš„ç²¾åï¼Œä¹Ÿæ˜¯'çƒŸé›¨'æ°”è´¨çš„æºæ³‰ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†ç™»ä¸´é—®æœˆæ¥¼ï¼Œä»è¿™é‡Œå¯ä»¥ä¿¯ç°å…¨å›­æ™¯è‰²ã€‚æœ€åï¼Œæˆ‘ä»¬å°†åˆ°è¾¾ç´«å¾¡æ¹¾ç å¤´ï¼Œè¿™é‡Œæ›¾æ˜¯å¸åç™»èˆ¹çš„åœ°æ–¹ï¼Œç°åœ¨æ˜¯æ¸¸è§ˆé•¿æ²³çš„èµ·ç‚¹ã€‚"
            },
            ditan: {
                title: "ä¸åœ°å›åŒå‘¼å¸",
                content: "æ¬¢è¿æ¥åˆ°ä¸åœ°å›åŒå‘¼å¸è·¯çº¿ã€‚è¿™æ¡è·¯çº¿è·Ÿéšå²é“ç”Ÿçš„è„šæ­¥ï¼Œæ¢ç´¢åœ°å›çš„æ–‡å­¦ä¸ç”Ÿå‘½æ„ä¹‰ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å°†å‚è§‚æ–¹æ³½å›ï¼Œè¿™æ˜¯çš‡å¸ç¥­ç¥€'çš‡åœ°ç¥‡'çš„ç¥åœ£å›åŸã€‚æ¥ç€ï¼Œæˆ‘ä»¬å°†å‰å¾€å¤æŸåŒºï¼Œè¿™é‡Œçš„å¤æŸå·²æœ‰ä¸‰å››ç™¾å¹´å†å²ï¼Œè§è¯äº†åœ°å›çš„æ²§æ¡‘å˜è¿ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†å‚è§‚ç¥åº“ä¸ç¥­å™¨åº“ï¼Œè¿™é‡Œæ›¾å­˜æ”¾ç¥ç‰Œä¸ç¤¼å™¨ã€‚æœ€åï¼Œæˆ‘ä»¬å°†åˆ°è¾¾é’Ÿæ¥¼ï¼Œå†å²ä¸Šç¥­ç¥€å‰ä¼šåœ¨æ­¤é¸£é’Ÿã€‚åœ°å›å› ä¸ºå²é“ç”Ÿçš„æ•£æ–‡ã€Šæˆ‘ä¸åœ°å›ã€‹è€Œæˆä¸ºäº†ä¸€ä¸ªå……æ»¡æ–‡å­¦æ°”æ¯å’Œç”Ÿå‘½åŠ›é‡çš„åœ°æ–¹ã€‚"
            }
        };
        
        // è¯­éŸ³æ’­æ”¾ç›¸å…³å˜é‡
        let currentUtterance = null;
        let isPlaying = false;
        let currentRoute = null;
        
        // åˆå§‹åŒ–è¯­éŸ³åˆæˆ
        function initSpeechSynthesis() {
            if ('speechSynthesis' in window) {
                // è®¾ç½®é»˜è®¤è¯­éŸ³ä¸ºä¸­æ–‡
                const voices = window.speechSynthesis.getVoices();
                const chineseVoice = voices.find(voice => 
                    voice.lang.includes('zh') || voice.name.includes('Chinese')
                );
                if (chineseVoice) {
                    // å­˜å‚¨é»˜è®¤è¯­éŸ³
                    localStorage.setItem('defaultVoice', chineseVoice.name);
                }
            }
        }
        
        // æ’­æ”¾è¯­éŸ³è®²è§£
        function toggleVoiceGuide(routeId) {
            if (!('speechSynthesis' in window)) {
                alert('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆåŠŸèƒ½');
                return;
            }
            
            // å¦‚æœå½“å‰æ­£åœ¨æ’­æ”¾ï¼Œåœæ­¢æ’­æ”¾
            if (isPlaying) {
                stopVoiceGuide();
                return;
            }
            
            // è·å–è·¯çº¿è®²è§£å†…å®¹
            const explanation = routeExplanations[routeId];
            if (!explanation) {
                return;
            }
            
            // ä¿å­˜å½“å‰è·¯çº¿
            currentRoute = routeId;
            
            // åˆ›å»ºè¯­éŸ³åˆæˆå¯¹è±¡
            const utterance = new SpeechSynthesisUtterance();
            utterance.text = explanation.content;
            utterance.lang = 'zh-CN';
            
            // è®¾ç½®è¯­é€Ÿ
            const rate = parseFloat(document.getElementById('rate-slider').value);
            utterance.rate = rate;
            
            // è®¾ç½®è¯­éŸ³
            const voices = window.speechSynthesis.getVoices();
            const defaultVoiceName = localStorage.getItem('defaultVoice');
            const voice = voices.find(v => v.name === defaultVoiceName || v.lang.includes('zh'));
            if (voice) {
                utterance.voice = voice;
            }
            
            // è¯­éŸ³æ’­æ”¾å¼€å§‹äº‹ä»¶
            utterance.onstart = function() {
                isPlaying = true;
                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                const playBtn = document.getElementById(`play-btn-${routeId}`);
                if (playBtn) {
                    playBtn.classList.add('playing');
                    playBtn.innerHTML = `
                        <span>â¸ï¸</span>
                        <span>æš‚åœè®²è§£</span>
                        <div class="voice-wave">
                            <div class="voice-bar"></div>
                            <div class="voice-bar"></div>
                            <div class="voice-bar"></div>
                            <div class="voice-bar"></div>
                        </div>
                    `;
                }
                // æ›´æ–°çŠ¶æ€ä¿¡æ¯
                const statusElement = document.getElementById(`voice-status-${routeId}`);
                if (statusElement) {
                    statusElement.innerHTML = `<span style="color: var(--c-red);">æ­£åœ¨æ’­æ”¾è®²è§£...</span>`;
                }
            };
            
            // è¯­éŸ³æ’­æ”¾ç»“æŸäº‹ä»¶
            utterance.onend = function() {
                isPlaying = false;
                currentUtterance = null;
                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                const playBtn = document.getElementById(`play-btn-${routeId}`);
                if (playBtn) {
                    playBtn.classList.remove('playing');
                    playBtn.innerHTML = `
                        <span>â–¶ï¸</span>
                        <span>æ’­æ”¾è®²è§£</span>
                        <div class="voice-wave">
                            <div class="voice-bar"></div>
                            <div class="voice-bar"></div>
                            <div class="voice-bar"></div>
                            <div class="voice-bar"></div>
                        </div>
                    `;
                }
                // æ›´æ–°çŠ¶æ€ä¿¡æ¯
                const statusElement = document.getElementById(`voice-status-${routeId}`);
                if (statusElement) {
                    statusElement.innerHTML = '<span style="color: var(--c-gold);">è®²è§£æ’­æ”¾ç»“æŸ</span>';
                }
            };
            
            // è¯­éŸ³æ’­æ”¾é”™è¯¯äº‹ä»¶
            utterance.onerror = function() {
                isPlaying = false;
                currentUtterance = null;
                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                const playBtn = document.getElementById(`play-btn-${routeId}`);
                if (playBtn) {
                    playBtn.classList.remove('playing');
                    playBtn.innerHTML = `
                        <span>â–¶ï¸</span>
                        <span>æ’­æ”¾è®²è§£</span>
                        <div class="voice-wave">
                            <div class="voice-bar"></div>
                            <div class="voice-bar"></div>
                            <div class="voice-bar"></div>
                            <div class="voice-bar"></div>
                        </div>
                    `;
                }
                // æ›´æ–°çŠ¶æ€ä¿¡æ¯
                const statusElement = document.getElementById(`voice-status-${routeId}`);
                if (statusElement) {
                    statusElement.innerHTML = '<span style="color: var(--c-red);">è®²è§£æ’­æ”¾å¤±è´¥</span>';
                }
            };
            
            // ä¿å­˜å½“å‰è¯­éŸ³å¯¹è±¡
            currentUtterance = utterance;
            
            // æ’­æ”¾è¯­éŸ³
            window.speechSynthesis.speak(utterance);
        }
        
        // åœæ­¢è¯­éŸ³è®²è§£
        function stopVoiceGuide() {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                isPlaying = false;
                currentUtterance = null;
                
                // é‡ç½®æ‰€æœ‰æ’­æ”¾æŒ‰é’®
                const playBtns = document.querySelectorAll('[id^="play-btn-"]');
                playBtns.forEach(btn => {
                    btn.classList.remove('playing');
                    btn.innerHTML = `
                        <span>â–¶ï¸</span>
                        <span>æ’­æ”¾è®²è§£</span>
                        <div class="voice-wave">
                            <div class="voice-bar"></div>
                            <div class="voice-bar"></div>
                            <div class="voice-bar"></div>
                            <div class="voice-bar"></div>
                        </div>
                    `;
                });
                
                // é‡ç½®æ‰€æœ‰çŠ¶æ€ä¿¡æ¯
                const statusElements = document.querySelectorAll('[id^="voice-status-"]');
                statusElements.forEach(el => {
                    el.textContent = 'ç‚¹å‡»æ’­æ”¾æŒ‰é’®ï¼Œè†å¬è·¯çº¿è®²è§£';
                });
            }
        }
        
        // åˆå§‹åŒ–è¯­éŸ³åˆæˆå’Œäº‹ä»¶ç›‘å¬
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–è¯­éŸ³åˆæˆ
            initSpeechSynthesis();
            
            // ç›‘å¬è¯­éŸ³åˆ—è¡¨åŠ è½½å®Œæˆäº‹ä»¶
            window.speechSynthesis.onvoiceschanged = initSpeechSynthesis;
            
            // è¯­é€Ÿæ»‘å—äº‹ä»¶ç›‘å¬
            const rateSlider = document.getElementById('rate-slider');
            if (rateSlider) {
                rateSlider.addEventListener('input', function() {
                    const rate = this.value;
                    document.getElementById('rate-value').textContent = rate;
                    // å¦‚æœå½“å‰æ­£åœ¨æ’­æ”¾ï¼Œæ›´æ–°è¯­é€Ÿ
                    if (currentUtterance && isPlaying) {
                        // åœæ­¢å½“å‰æ’­æ”¾
                        stopVoiceGuide();
                        // é‡æ–°æ’­æ”¾
                        toggleVoiceGuide(currentRoute);
                    }
                });
            }
            
            // åˆå§‹åŒ–è™šæ‹Ÿæ¼«æ¸¸
            initPanorama();
            
            // åˆå§‹åŒ–æ–‡åŒ–çŸ¥è¯†ç­”é¢˜
            initQuiz();
            
            // åˆå§‹åŒ–ç¤¾äº¤åˆ†äº«
            initSocialSharing();
        });
        
        // è™šæ‹Ÿæ¼«æ¸¸ç›¸å…³å‡½æ•°
        
        // å…¨æ™¯ç§»åŠ¨å‡½æ•°
        function panoramaMove(routeId, distance) {
            const panoramaContainer = document.getElementById(`panorama-${routeId}`);
            if (!panoramaContainer) return;
            
            const panoramaImage = panoramaContainer.querySelector('.panorama-image');
            if (!panoramaImage) return;
            
            // è·å–å½“å‰çš„transformå€¼
            const currentTransform = getComputedStyle(panoramaImage).transform;
            let translateX = 0;
            
            // è§£æå½“å‰çš„translateXå€¼
            if (currentTransform !== 'none') {
                const matrix = new DOMMatrix(currentTransform);
                translateX = matrix.m41;
            }
            
            // è®¡ç®—æ–°çš„translateXå€¼ï¼Œé™åˆ¶åœ¨-50%åˆ°0ä¹‹é—´
            const newTranslateX = Math.max(-500, Math.min(0, translateX + distance));
            
            // æ›´æ–°å…¨æ™¯å›¾ä½ç½®
            panoramaImage.style.transform = `translateX(${newTranslateX}px)`;
        }
        
        // å…¨æ™¯ç¼©æ”¾å‡½æ•°
        function panoramaZoom(routeId, scaleFactor) {
            const panoramaContainer = document.getElementById(`panorama-${routeId}`);
            if (!panoramaContainer) return;
            
            const panoramaImage = panoramaContainer.querySelector('.panorama-image');
            if (!panoramaImage) return;
            
            // è·å–å½“å‰çš„transformå€¼
            const currentTransform = getComputedStyle(panoramaImage).transform;
            let scale = 1;
            let translateX = 0;
            
            // è§£æå½“å‰çš„scaleå€¼å’ŒtranslateXå€¼
            if (currentTransform !== 'none') {
                const matrix = new DOMMatrix(currentTransform);
                scale = Math.sqrt(matrix.m11 * matrix.m11 + matrix.m12 * matrix.m12);
                translateX = matrix.m41;
            }
            
            // è®¡ç®—æ–°çš„scaleå€¼ï¼Œé™åˆ¶åœ¨1åˆ°2ä¹‹é—´
            const newScale = Math.max(1, Math.min(2, scale * scaleFactor));
            
            // æ›´æ–°å…¨æ™¯å›¾ç¼©æ”¾
            panoramaImage.style.transform = `translateX(${translateX}px) scale(${newScale})`;
        }
        
        // å…¨æ™¯é‡ç½®å‡½æ•°
        function panoramaReset(routeId) {
            const panoramaContainer = document.getElementById(`panorama-${routeId}`);
            if (!panoramaContainer) return;
            
            const panoramaImage = panoramaContainer.querySelector('.panorama-image');
            if (!panoramaImage) return;
            
            // é‡ç½®transform
            panoramaImage.style.transform = '';
        }
        
        // åˆå§‹åŒ–è™šæ‹Ÿæ¼«æ¸¸
        function initPanorama() {
            // ä¸ºæ‰€æœ‰çƒ­ç‚¹æ·»åŠ ç‚¹å‡»äº‹ä»¶
            const hotspots = document.querySelectorAll('.hotspot');
            
            hotspots.forEach(hotspot => {
                hotspot.addEventListener('click', function() {
                    const label = this.dataset.label;
                    const info = this.dataset.info;
                    const container = this.closest('.panorama-container');
                    const routeId = container.id.replace('panorama-', '');
                    
                    // æ›´æ–°å¯¹åº”è·¯çº¿çš„çƒ­ç‚¹ä¿¡æ¯é¢æ¿
                    const hotspotInfo = container.querySelector('.hotspot-info');
                    const hotspotTitle = container.querySelector('.hotspot-title');
                    const hotspotContent = container.querySelector('.hotspot-content');
                    
                    if (hotspotInfo && hotspotTitle && hotspotContent) {
                        hotspotTitle.textContent = label;
                        hotspotContent.textContent = info;
                        hotspotInfo.classList.add('active');
                    }
                });
            });
            
            // ç‚¹å‡»ä¿¡æ¯é¢æ¿å¤–éƒ¨å…³é—­
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.hotspot') && !e.target.closest('.hotspot-info')) {
                    const hotspotInfos = document.querySelectorAll('.hotspot-info');
                    hotspotInfos.forEach(info => {
                        info.classList.remove('active');
                    });
                }
            });
            
            // ä¸ºæ‰€æœ‰å…¨æ™¯å®¹å™¨æ·»åŠ æ‹–æ‹½åŠŸèƒ½
            const panoramaContainers = document.querySelectorAll('.panorama-container');
            panoramaContainers.forEach(container => {
                let isDragging = false;
                let startX = 0;
                let translateX = 0;
                
                container.addEventListener('mousedown', function(e) {
                    isDragging = true;
                    startX = e.clientX;
                    const currentTransform = getComputedStyle(container.querySelector('.panorama-image')).transform;
                    if (currentTransform !== 'none') {
                        const matrix = new DOMMatrix(currentTransform);
                        translateX = matrix.m41;
                    }
                });
                
                container.addEventListener('mousemove', function(e) {
                    if (!isDragging) return;
                    
                    const deltaX = e.clientX - startX;
                    startX = e.clientX;
                    
                    // æ›´æ–°å…¨æ™¯å›¾ä½ç½®
                    panoramaMove(container.id.split('-')[1], deltaX);
                });
                
                container.addEventListener('mouseup', function() {
                    isDragging = false;
                });
                
                container.addEventListener('mouseleave', function() {
                    isDragging = false;
                });
            });
        }
        
        // æ–‡åŒ–çŸ¥è¯†ç­”é¢˜åŠŸèƒ½
        function initQuiz() {
            // åˆ›å»ºç­”é¢˜æ¨¡æ€æ¡†
            const quizModal = document.createElement('div');
            quizModal.id = 'quiz-modal';
            quizModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                z-index: 2000;
                display: none;
                justify-content: center;
                align-items: center;
            `;
            
            quizModal.innerHTML = `
                <div style="background: white; padding: 40px; border-radius: 10px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
                    <h3 style="font-family: var(--f-title); font-size: 1.8rem; color: var(--c-red); margin-bottom: 30px; text-align: center;">æ–‡åŒ–çŸ¥è¯†å°æµ‹è¯•</h3>
                    <div id="quiz-content"></div>
                    <div id="quiz-result" style="margin-top: 20px; padding: 20px; background: var(--c-paper); border-radius: 8px; display: none;"></div>
                    <div style="display: flex; gap: 15px; justify-content: center; margin-top: 30px;">
                        <button id="quiz-submit" class="collect-all-btn" style="display: none;">æäº¤ç­”æ¡ˆ</button>
                        <button id="quiz-close" class="collect-all-btn" style="background: var(--c-gray);">å…³é—­</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(quizModal);
            
            // å…³é—­æ¨¡æ€æ¡†
            document.getElementById('quiz-close').addEventListener('click', function() {
                quizModal.style.display = 'none';
            });
            
            // æ–‡åŒ–çŸ¥è¯†é¢˜åº“
            const quizQuestions = [
                {
                    question: 'ä¸‡æ¾è€äººå¡”æ˜¯ä¸ºäº†çºªå¿µå“ªä½å†å²äººç‰©è€Œå»ºï¼Ÿ',
                    options: ['ä¸‡æ¾è¡Œç§€', 'ä¹¾éš†çš‡å¸', 'çº³å…°æ€§å¾·', 'æ›¹é›ªèŠ¹'],
                    correct: 0
                },
                {
                    question: 'ã€Šæˆ‘ä¸åœ°å›ã€‹çš„ä½œè€…æ˜¯è°ï¼Ÿ',
                    options: ['å²é“ç”Ÿ', 'é²è¿…', 'è€èˆ', 'æœ±è‡ªæ¸…'],
                    correct: 0
                },
                {
                    question: 'ç´«ç«¹é™¢å…¬å›­çš„"ç´«ç«¹"å¾—åäºå“ªç§æ¤ç‰©ï¼Ÿ',
                    options: ['ç´«ç«¹', 'é’ç«¹', 'æ¯›ç«¹', 'åˆšç«¹'],
                    correct: 0
                }
            ];
            
            // æ˜¾ç¤ºç­”é¢˜
            window.showQuiz = function() {
                const quizContent = document.getElementById('quiz-content');
                const quizResult = document.getElementById('quiz-result');
                const quizSubmit = document.getElementById('quiz-submit');
                
                // é‡ç½®ç­”é¢˜çŠ¶æ€
                quizResult.style.display = 'none';
                quizSubmit.style.display = 'block';
                
                // ç”Ÿæˆé¢˜ç›®HTML
                let quizHTML = '';
                quizQuestions.forEach((q, index) => {
                    quizHTML += `
                        <div style="margin-bottom: 25px;">
                            <p style="font-size: 1.1rem; margin-bottom: 15px; font-weight: bold;">${index + 1}. ${q.question}</p>
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                ${q.options.map((option, optIndex) => `
                                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 10px; border-radius: 4px; transition: background-color 0.2s;">
                                        <input type="radio" name="quiz-${index}" value="${optIndex}" style="accent-color: var(--c-red);">
                                        <span>${option}</span>
                                    </label>
                                `).join('')}
                            </div>
                        </div>
                    `;
                });
                
                quizContent.innerHTML = quizHTML;
                quizModal.style.display = 'flex';
            };
            
            // æäº¤ç­”æ¡ˆ
            document.getElementById('quiz-submit').addEventListener('click', function() {
                let correctCount = 0;
                quizQuestions.forEach((q, index) => {
                    const selectedOption = document.querySelector(`input[name="quiz-${index}"]:checked`);
                    if (selectedOption && parseInt(selectedOption.value) === q.correct) {
                        correctCount++;
                    }
                });
                
                // æ˜¾ç¤ºç»“æœ
                const quizResult = document.getElementById('quiz-result');
                const quizSubmit = document.getElementById('quiz-submit');
                
                quizResult.innerHTML = `
                    <h4 style="color: var(--c-red); margin-bottom: 15px;">æµ‹è¯•ç»“æœ</h4>
                    <p>ä½ ç­”å¯¹äº† ${correctCount}/${quizQuestions.length} é“é¢˜ï¼</p>
                    ${correctCount === quizQuestions.length ? 
                        '<p style="color: var(--c-gold);">ğŸ‰ æ­å–œä½ å…¨éƒ¨ç­”å¯¹ï¼</p>' : 
                        '<p style="color: var(--c-gray);">ç»§ç»­åŠ æ²¹ï¼Œäº†è§£æ›´å¤šåŒ—å¹³æ–‡åŒ–ï¼</p>'
                    }
                `;
                quizResult.style.display = 'block';
                quizSubmit.style.display = 'none';
                
                // å¦‚æœå…¨éƒ¨ç­”å¯¹ï¼Œæ”¶é›†ç‰¹æ®Šå°ç« 
                if (correctCount === quizQuestions.length) {
                    collectStamp('quiz-master');
                }
            });
            
            // æ·»åŠ ç­”é¢˜æŒ‰é’®åˆ°è·¯çº¿è¯¦æƒ…
            const addQuizButtons = () => {
                const routeDetails = document.querySelectorAll('.route-details-section');
                routeDetails.forEach(detail => {
                    // æ£€æŸ¥æ˜¯å¦å·²ç»æ·»åŠ äº†ç­”é¢˜æŒ‰é’®
                    if (!detail.querySelector('.quiz-btn')) {
                        const viewBtn = detail.querySelector('.view-btn');
                        if (viewBtn) {
                            const quizBtn = document.createElement('button');
                            quizBtn.className = 'view-btn';
                            quizBtn.style.marginLeft = '15px';
                            quizBtn.style.background = 'var(--c-gold)';
                            quizBtn.textContent = 'æ–‡åŒ–çŸ¥è¯†å°æµ‹è¯•';
                            quizBtn.onclick = showQuiz;
                            viewBtn.parentNode.insertBefore(quizBtn, viewBtn.nextSibling);
                        }
                    }
                });
            };
            
            // åˆå§‹åŒ–æ—¶æ·»åŠ ç­”é¢˜æŒ‰é’®
            addQuizButtons();
        }
        
        // å‡çº§ç¤¾äº¤åˆ†äº«åŠŸèƒ½
        function initSocialSharing() {
            // ä¸ºåˆ†äº«æŒ‰é’®æ·»åŠ åŠŸèƒ½
            const shareBtn = document.querySelector('.share-btn');
            if (shareBtn) {
                shareBtn.onclick = function() {
                    // åˆ›å»ºåˆ†äº«é€‰é¡¹
                    const shareOptions = [
                        { name: 'å¾®ä¿¡æœ‹å‹åœˆ', icon: 'ğŸ“±', action: () => alert('å¾®ä¿¡æœ‹å‹åœˆåˆ†äº«åŠŸèƒ½å·²å¯ç”¨') },
                        { name: 'å¾®åš', icon: 'ğŸ¦', action: () => alert('å¾®åšåˆ†äº«åŠŸèƒ½å·²å¯ç”¨') },
                        { name: 'ç”Ÿæˆæµ·æŠ¥', icon: 'ğŸ“¸', action: () => generatePoster() },
                        { name: 'å¤åˆ¶é“¾æ¥', icon: 'ğŸ”—', action: () => copyShareLink() }
                    ];
                    
                    // åˆ›å»ºåˆ†äº«é¢æ¿
                    const sharePanel = document.createElement('div');
                    sharePanel.style.cssText = `
                        position: fixed;
                        bottom: 0;
                        left: 0;
                        width: 100%;
                        background: white;
                        padding: 30px;
                        box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
                        z-index: 2000;
                        border-radius: 20px 20px 0 0;
                    `;
                    
                    sharePanel.innerHTML = `
                        <div style="display: flex; flex-direction: column; gap: 20px;">
                            <h3 style="font-family: var(--f-title); font-size: 1.5rem; color: var(--c-red); text-align: center;">åˆ†äº«åŸå¸‚è®°å¿†</h3>
                            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px;">
                                ${shareOptions.map(opt => `
                                    <div style="display: flex; flex-direction: column; align-items: center; gap: 10px; cursor: pointer; padding: 20px; border-radius: 10px; transition: background-color 0.2s;">
                                        <div style="font-size: 2.5rem;">${opt.icon}</div>
                                        <span style="font-size: 0.9rem;">${opt.name}</span>
                                    </div>
                                `).join('')}
                            </div>
                            <button id="share-close" class="collect-all-btn" style="margin: 0 auto; display: block;">å…³é—­</button>
                        </div>
                    `;
                    
                    document.body.appendChild(sharePanel);
                    
                    // æ·»åŠ äº‹ä»¶ç›‘å¬
                    const shareItems = sharePanel.querySelectorAll('div > div');
                    shareItems.forEach((item, index) => {
                        item.addEventListener('click', shareOptions[index].action);
                        item.addEventListener('mouseenter', function() {
                            this.style.backgroundColor = 'var(--c-paper)';
                        });
                        item.addEventListener('mouseleave', function() {
                            this.style.backgroundColor = '';
                        });
                    });
                    
                    // å…³é—­åˆ†äº«é¢æ¿
                    document.getElementById('share-close').addEventListener('click', function() {
                        sharePanel.remove();
                    });
                };
            }
        }
        
        // ç”Ÿæˆåˆ†äº«æµ·æŠ¥
        function generatePoster() {
            alert('ğŸ“¸ æµ·æŠ¥ç”ŸæˆåŠŸèƒ½å·²å¯ç”¨ï¼\næµ·æŠ¥å°†åŒ…å«æ‚¨çš„é›†ç« è¿›åº¦å’Œå½“å‰è·¯çº¿ä¿¡æ¯ã€‚');
        }
        
        // å¤åˆ¶åˆ†äº«é“¾æ¥
        function copyShareLink() {
            navigator.clipboard.writeText(window.location.href).then(() => {
                alert('ğŸ”— åˆ†äº«é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            }).catch(err => {
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶é“¾æ¥');
            });
        }
    </script>
    <script>
    // --- AIè¯­è¨€å¤§æ¨¡å‹åŠŸèƒ½ (çœŸå®åç«¯æ¥å…¥) --- //

    // 1. å®šä¹‰åç«¯åœ°å€ (æœ¬åœ°å¼€å‘ç”¨ localhostï¼Œä¸Šçº¿åæ”¹ä¸ºçœŸå®åŸŸå)
    const API_URL = 'http://localhost:3000/api/chat';
    // ç»´æŠ¤ä¸€ä¸ªç®€å•çš„å®¢æˆ·ç«¯å¯¹è¯å†å²ï¼Œå‘ç»™åç«¯ä¿æŒä¸Šä¸‹æ–‡
    let conversationHistory = [];

    // AIåŠ©æ‰‹DOMå…ƒç´ 
    // æ³¨æ„ï¼šè¿™é‡Œä½¿ç”¨ var æˆ–ä¸ä½¿ç”¨ const/let é‡æ–°è·å–ï¼Œé˜²æ­¢å’Œä¸Šæ–¹å…¶ä»–é€»è¾‘å†²çª
    // ä½†å› ä¸ºæˆ‘ä»¬åˆ é™¤äº†æ—§ä»£ç ï¼Œè¿™é‡Œç”¨ const æ˜¯å®‰å…¨çš„
    const aiBtn = document.getElementById('ai-btn');
    const aiChat = document.getElementById('ai-chat');
    const chatMessages = document.getElementById('chat-messages');
    const chatInput = document.getElementById('chat-input');
    const sendBtn = document.getElementById('send-btn');

    // åˆ‡æ¢AIèŠå¤©çª—å£
    function toggleAIChat() {
        const isHidden = aiChat.style.display === 'none' || aiChat.style.display === '';
        aiChat.style.display = isHidden ? 'flex' : 'none';
        if (isHidden) {
            // æ‰“å¼€æ—¶è‡ªåŠ¨èšç„¦è¾“å…¥æ¡†
            setTimeout(() => chatInput.focus(), 100);
        }
    }

    // æ·»åŠ æ¶ˆæ¯åˆ°ç•Œé¢
    function addMessage(text, isUser = false, isLoading = false) {
        const messageDiv = document.createElement('div');
        
        // è®¾ç½®æ ·å¼
        let bgColor = isUser ? 'var(--c-red)' : 'var(--c-paper)';
        let textColor = isUser ? 'white' : 'var(--c-ink)';
        let alignSelf = isUser ? 'flex-end' : 'flex-start';
        let borderRadius = isUser ? '18px 18px 5px 18px' : '18px 18px 18px 5px';

        // åŠ è½½çŠ¶æ€æ ·å¼
        if (isLoading) {
            messageDiv.id = 'ai-loading';
            text = 'âšª âšª âšª'; // æ€è€ƒåŠ¨ç”»å ä½
            bgColor = 'transparent';
            textColor = '#999';
        }

        messageDiv.style.cssText = `
            padding: 10px 15px;
            border-radius: ${borderRadius};
            align-self: ${alignSelf};
            max-width: 80%;
            background: ${bgColor};
            color: ${textColor};
            margin-bottom: 10px;
            word-wrap: break-word;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            line-height: 1.5;
        `;

        // å¦‚æœæ˜¯ AI å›å¤ï¼Œç®€å•å¤„ç†ä¸€ä¸‹ Markdown åŠ ç²—
        if (!isUser && !isLoading) {
            text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
        }

        messageDiv.innerHTML = `<p style="margin: 0;">${text}</p>`;
        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // å‘é€æ¶ˆæ¯ç»™åç«¯
    async function sendMessage() {
        const userMessage = chatInput.value.trim();
        if (!userMessage) return;

        // 1. æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯
        addMessage(userMessage, true);
        chatInput.value = '';
        chatInput.disabled = true;

        // 2. æ˜¾ç¤ºâ€œæ€è€ƒä¸­â€çŠ¶æ€
        addMessage('', false, true);

        try {
            // 3. è°ƒç”¨æˆ‘ä»¬åˆšæ‰å†™çš„ server.js
            const response = await fetch('/api/chat', { // ç¡®ä¿ç«¯å£æ˜¯ 3000
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    message: userMessage,
                    history: conversationHistory // å°†å†å²è®°å½•ä¼ ç»™åç«¯
                })
            });

            const data = await response.json();

            // 4. ç§»é™¤åŠ è½½åŠ¨ç”»
            const loadingDiv = document.getElementById('ai-loading');
            if (loadingDiv) loadingDiv.remove();

            // 5. æ˜¾ç¤º AI å›å¤
            if (data.reply) {
                addMessage(data.reply, false);
                
                // æ›´æ–°æœ¬åœ°å†å²è®°å½• (Google Gemini æ ¼å¼ï¼Œæˆ‘ä»¬åç«¯åšäº†è½¬æ¢é€‚é…)
                conversationHistory.push({ role: "user", parts: [{ text: userMessage }] });
                conversationHistory.push({ role: "model", parts: [{ text: data.reply }] });
                
                // ä¿æŒå†å²è®°å½•ä¸è¦å¤ªé•¿ï¼Œé˜²æ­¢æ¶ˆè€—å¤ªå¤š Token
                if(conversationHistory.length > 10) conversationHistory = conversationHistory.slice(-10);
            } else {
                addMessage("æŠ±æ­‰ï¼Œæˆ‘å¥½åƒæ²¡å¬æ¸…...", false);
            }

        } catch (error) {
            console.error("Chat Error:", error);
            const loadingDiv = document.getElementById('ai-loading');
            if (loadingDiv) loadingDiv.remove();
            // ä¿®æ”¹æŠ¥é”™æç¤ºï¼Œè®©å®ƒæ›´å‹å¥½
            addMessage("é£ç‰©å›æ­£åœ¨é—­å…³ä¿®ç‚¼ï¼ˆè¯·ç¡®è®¤ server.js æ˜¯å¦è¿è¡Œï¼Œä¸” API Key æ˜¯å¦æ­£ç¡®ï¼‰ã€‚", false);
        } finally {
            chatInput.disabled = false;
            chatInput.focus();
        }
    }

    // äº‹ä»¶ç›‘å¬
    // ä¸ºäº†é˜²æ­¢é‡å¤ç»‘å®šï¼Œå…ˆåˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨
    if (aiBtn) aiBtn.addEventListener('click', toggleAIChat);
    if (sendBtn) sendBtn.addEventListener('click', sendMessage);
    if (chatInput) {
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });
    }

    // ç‚¹å‡»å¤–éƒ¨å…³é—­çª—å£é€»è¾‘
    document.addEventListener('click', (e) => {
        if (aiChat.style.display === 'flex' && !aiChat.contains(e.target) && !aiBtn.contains(e.target)) {
            aiChat.style.display = 'none';
        }
    });

</script>
</body>
</html>